{
  "meta": {
    "project": "tote-web",
    "date": "2025-12-22",
    "prepared_by": "Generated by Software Development Manager"
  },
  "product_overview": "tote-web is a comprehensive lottery management system enabling automated lottery draws, multi-channel result publishing, real-time updates, and administrative control. It supports multiple lottery games with scheduled draws, generates personalized result images, and facilitates multi-platform publishing including Telegram, WhatsApp, Facebook, Instagram, and TikTok.",
  "core_goals": [
    "Automate 95% of lottery draw processes to minimize manual intervention",
    "Provide real-time lottery results with latency under 60 seconds",
    "Publish lottery results simultaneously across 5+ social media platforms",
    "Support scalability to handle over 100 daily draws without performance degradation",
    "Maintain complete transparency with full audit logging of all critical operations"
  ],
  "key_features": [
    "Automated daily draw generation and scheduling with configurable templates",
    "CRUD management of multiple lottery games (Triple, Ruleta, Animalitos) and their items",
    "Real-time result updates via WebSocket integration",
    "Multi-channel publishing system supporting Telegram, WhatsApp, Facebook, Instagram, and TikTok",
    "Secure JWT-based authentication with role-based access control",
    "Administrative dashboard for management of draws, games, templates, pauses, and users",
    "Automated generation of customized lottery result images using Sharp",
    "Telegram bot for remote administration and notifications (planned)",
    "Comprehensive audit logging and error handling with retry mechanisms",
    "Historical data access with statistics, filtering, and export capabilities"
  ],
  "user_flow_summary": [
    "Administrators log in securely using JWT authentication to access the dashboard and manage games, templates, pauses, and users.",
    "Daily, the system automatically generates scheduled draws based on active templates, accounting for pauses and holidays.",
    "Five minutes before scheduled draws, the system closes the draw, preselects a winner, and sends notifications via WebSocket and Telegram.",
    "At the exact draw time, the system confirms the winner, generates a personalized image, updates statuses, and triggers multi-channel publications.",
    "Publications to social channels are managed asynchronously with automatic retries on failures and status tracking.",
    "Players and the general public access the landing page to view real-time lottery results and statistics through an intuitive, responsive interface.",
    "Administrators can manually change winners within a five-minute window before draw execution, with audit logs and notifications.",
    "The Telegram bot (planned) enables remote management commands and system alerts to administrators."
  ],
  "validation_criteria": [
    "Automated draw generation produces correct scheduled draws per active templates daily at configured times.",
    "Closing and preselection of winners occurs exactly 5 minutes before draw times with valid random selection and notifications sent.",
    "Draw execution confirms winner, updates status, generates custom images within 5 seconds, and triggers successful publication records.",
    "Publications to all integrated channels succeed with 95%+ success rate, applying exponential backoff retries on failures up to three times.",
    "Authentication system enforces JWT token expiry, role-based access, and password hashing with bcrypt.",
    "WebSocket events correctly broadcast lottery state changes to subscribed clients with low latency.",
    "Audit logs record all critical user actions including manual winner changes with user info, timestamp, and IP.",
    "UI components are fully responsive with up-to-date draw information and real-time updates reflecting backend state.",
    "Testing coverage meets or exceeds 80% for services and utilities, and 70% for controllers with integration tests covering critical flows.",
    "System uptime maintained over 99.5% with monitoring alerts active for critical failures or job execution errors."
  ],
  "code_summary": {
    "projectName": "tote-web",
    "projectType": "fullstack",
    "techStack": {
      "frontend": {
        "framework": "Next.js 14+",
        "language": "JavaScript",
        "uiLibrary": "React 18+",
        "styling": "TailwindCSS",
        "components": "shadcn/ui",
        "stateManagement": "Zustand",
        "icons": "Lucide React",
        "realtime": "Socket.io Client",
        "forms": "React Hook Form + Zod",
        "notifications": "Sonner",
        "dateHandling": "date-fns, date-fns-tz"
      },
      "backend": {
        "runtime": "Node.js 20+",
        "framework": "Express.js",
        "language": "JavaScript (ES Modules)",
        "database": "PostgreSQL",
        "orm": "Prisma",
        "authentication": "JWT + bcrypt",
        "scheduling": "node-cron",
        "imageProcessing": "Sharp",
        "realtime": "Socket.io",
        "logging": "Winston + Pino",
        "security": "Helmet, CORS, Rate Limiting"
      },
      "integrations": [
        "Telegram Bot API",
        "WhatsApp (Baileys)",
        "Facebook Graph API",
        "Instagram Graph API",
        "TikTok Content Posting API"
      ]
    },
    "features": [
      {
        "name": "Landing Page",
        "description": "Public homepage with real-time lottery results",
        "routes": [
          "/"
        ]
      },
      {
        "name": "Authentication",
        "description": "JWT-based login system for administrators",
        "routes": [
          "/login",
          "/api/auth"
        ]
      },
      {
        "name": "Admin Dashboard",
        "description": "Complete administrative interface for lottery management",
        "routes": [
          "/admin",
          "/dashboard"
        ]
      },
      {
        "name": "Game Management",
        "description": "CRUD operations for lottery games (Triple, Ruleta)",
        "routes": [
          "/admin/juegos",
          "/api/games"
        ]
      },
      {
        "name": "Draw Management",
        "description": "Manage lottery draws, results, and scheduling",
        "routes": [
          "/admin/sorteos",
          "/api/draws"
        ]
      },
      {
        "name": "Player Portal",
        "description": "Online lottery ticket purchasing system",
        "routes": [
          "/jugar",
          "/api/tickets"
        ]
      },
      {
        "name": "Balance Management",
        "description": "Deposits, withdrawals, and account balance tracking",
        "routes": [
          "/depositos",
          "/retiros",
          "/balance-historico",
          "/api/deposits",
          "/api/withdrawals"
        ]
      },
      {
        "name": "Real-time Updates",
        "description": "WebSocket-based live results and notifications",
        "technology": "Socket.io"
      },
      {
        "name": "Multi-channel Publishing",
        "description": "Automated result publishing to Telegram, WhatsApp, Facebook, Instagram, TikTok",
        "routes": [
          "/api/channels"
        ]
      },
      {
        "name": "Image Generation",
        "description": "Automated lottery result image creation with Sharp",
        "routes": [
          "/api/images"
        ]
      },
      {
        "name": "Scheduled Jobs",
        "description": "Automated daily draw generation, closing, and execution",
        "technology": "node-cron"
      },
      {
        "name": "Telegram Bot",
        "description": "Administrative bot for remote management",
        "routes": [
          "/api/admin"
        ]
      },
      {
        "name": "Tripleta System",
        "description": "Special three-number lottery game variant",
        "routes": [
          "/tripletas",
          "/api/tripleta"
        ]
      },
      {
        "name": "Provider Integration",
        "description": "External lottery provider API integration",
        "routes": [
          "/api/providers"
        ]
      },
      {
        "name": "Analytics & Monitoring",
        "description": "Draw analysis, statistics, and system monitoring",
        "routes": [
          "/api/analysis",
          "/api/monitor"
        ]
      }
    ],
    "ports": {
      "frontend": 3000,
      "backend": 3001
    },
    "database": "PostgreSQL",
    "deployment": {
      "production": "https://tote.atilax.io",
      "containerization": "Docker Compose",
      "processManager": "PM2"
    },
    "keyDirectories": {
      "frontend": "/home/diazhh/dev/tote-web/frontend",
      "backend": "/home/diazhh/dev/tote-web/backend",
      "docs": "/home/diazhh/dev/tote-web/docs"
    }
  }
}
